<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Entity Framework Week Part 4: Features and Further Investigations | Ian Nelson</title>
<meta name="keywords" content="tidy">
<meta name="description" content="This is the fourth in a series of five posts recounting my experiences using Entity Framework Code-First to replace ADO.NET and stored procedures in a client’s existing application. The introductory post in the series is here.
I didn’t want this series of posts to descend into a point-scoring NHibernate-versus-Entity Framework comparison, but…
I now have a basic proof-of-concept up and running, with my client’s nascent application now being powered by Entity Framework Code-First CTP5 rather than a hand-rolled DAL. So, I had some time to consider future functional and non-functional requirements that the team would be asked to develop and support, and investigate how EF would meet the challenge.">
<meta name="author" content="">
<link rel="canonical" href="https://bloghugo.iannelson.uk/entity-framework-week-part-4-features-and-further-investigations/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://bloghugo.iannelson.uk/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://bloghugo.iannelson.uk/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://bloghugo.iannelson.uk/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://bloghugo.iannelson.uk/apple-touch-icon.png">
<link rel="mask-icon" href="https://bloghugo.iannelson.uk/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://bloghugo.iannelson.uk/entity-framework-week-part-4-features-and-further-investigations/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://bloghugo.iannelson.uk/entity-framework-week-part-4-features-and-further-investigations/">
  <meta property="og:site_name" content="Ian Nelson">
  <meta property="og:title" content="Entity Framework Week Part 4: Features and Further Investigations">
  <meta property="og:description" content="This is the fourth in a series of five posts recounting my experiences using Entity Framework Code-First to replace ADO.NET and stored procedures in a client’s existing application. The introductory post in the series is here.
I didn’t want this series of posts to descend into a point-scoring NHibernate-versus-Entity Framework comparison, but…
I now have a basic proof-of-concept up and running, with my client’s nascent application now being powered by Entity Framework Code-First CTP5 rather than a hand-rolled DAL. So, I had some time to consider future functional and non-functional requirements that the team would be asked to develop and support, and investigate how EF would meet the challenge.">
  <meta property="og:locale" content="en-gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2011-03-10T09:03:00+00:00">
    <meta property="article:modified_time" content="2025-04-21T21:56:00+01:00">
    <meta property="article:tag" content="Tidy">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Entity Framework Week Part 4: Features and Further Investigations">
<meta name="twitter:description" content="This is the fourth in a series of five posts recounting my experiences using Entity Framework Code-First to replace ADO.NET and stored procedures in a client’s existing application. The introductory post in the series is here.
I didn’t want this series of posts to descend into a point-scoring NHibernate-versus-Entity Framework comparison, but…
I now have a basic proof-of-concept up and running, with my client’s nascent application now being powered by Entity Framework Code-First CTP5 rather than a hand-rolled DAL. So, I had some time to consider future functional and non-functional requirements that the team would be asked to develop and support, and investigate how EF would meet the challenge.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://bloghugo.iannelson.uk/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Entity Framework Week Part 4: Features and Further Investigations",
      "item": "https://bloghugo.iannelson.uk/entity-framework-week-part-4-features-and-further-investigations/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Entity Framework Week Part 4: Features and Further Investigations",
  "name": "Entity Framework Week Part 4: Features and Further Investigations",
  "description": "This is the fourth in a series of five posts recounting my experiences using Entity Framework Code-First to replace ADO.NET and stored procedures in a client’s existing application. The introductory post in the series is here.\nI didn’t want this series of posts to descend into a point-scoring NHibernate-versus-Entity Framework comparison, but…\nI now have a basic proof-of-concept up and running, with my client’s nascent application now being powered by Entity Framework Code-First CTP5 rather than a hand-rolled DAL. So, I had some time to consider future functional and non-functional requirements that the team would be asked to develop and support, and investigate how EF would meet the challenge.\n",
  "keywords": [
    "tidy"
  ],
  "articleBody": "This is the fourth in a series of five posts recounting my experiences using Entity Framework Code-First to replace ADO.NET and stored procedures in a client’s existing application. The introductory post in the series is here.\nI didn’t want this series of posts to descend into a point-scoring NHibernate-versus-Entity Framework comparison, but…\nI now have a basic proof-of-concept up and running, with my client’s nascent application now being powered by Entity Framework Code-First CTP5 rather than a hand-rolled DAL. So, I had some time to consider future functional and non-functional requirements that the team would be asked to develop and support, and investigate how EF would meet the challenge.\nCaching I was genuinely surprised to learn that Entity Framework still doesn’t include any out-of-the-box support for integrating second-level caching, for example to cache reference data. It seems there is a body of opinion stating that caching should not be the responsibility of the data access layer. I disagree, and I think this is one of the major benefits NHibernate still has over Entity Framework, with its multiple flexible and configurable second-level cache providers.\nTargeting Alternative Providers (SQLite) When working with NHibernate, I often target SQLite for fast integration tests against an in-memory database, rather than maintaining a testing version of the MSSQL/Oracle databases that my applications usually use for their bitbucket. I was pleased to see the discussions on the System.Data.SQLite page suggesting that this approach is possible with Entity Framework too, but I didn’t spend any time attempting to get this working.\nAuditing Functionality Entity Framework does not appear to support the rich events and listeners model that is offered by NHibernate and frequently used to develop application auditing functionality. The recommended solution to achieve this scenario is to override the virtual SaveChanges method on DbContext and add validation and auditing logic there. For more details, see page 261 of Programming Entity Framework.\nBulk Operations I have not yet encountered any Entity Framework support for bulk update/delete operations akin to NHibernate’s Executable DML functionality. Such requirements are usually relatively rare, but it’s a shame to have to fall back to writing stored procedures for relatively simple operations which can be described in terms of the domain model.\nQuery Batching There does not appear to be any way to do query batching in Entity Framework, as per NHibernate Futures. Multiple queries result in multiple network trips to the database, sadly. Similarly, there’s no support for write batching and batched collection loads.\nConcurrency and Versioning Entity framework supports optimistic concurrency. Chapter 23 of Programming Entity Framework explains in detail how this can be configured and utilised by your application. Entity Framework also supports rowversion fields for concurrency checks.\nExtra-Lazy Properties Unlike NHibernate, Entity Framework currently has no notion of “extra-lazy” properties. Requesting the Count of a child collection (e.g. Order.Lines.Count) will therefore trigger the loading of all entities (Lines) in the child collection. Not nice. Yes, we can work around this by making the appropriate count query at a higher level but it’s much nicer to be able to traverse the domain model relationships and let persistence ignorance work it’s magic.\nIntegration with the Wider .NET Stack To my mind, one of the key selling points of Entity Framework over NHibernate is its out-of-the-box integration with other areas of the .NET stack – notably the ability to power ASP.NET Dynamic Data sites (which are great for simple pages to maintain reference data) and WCF Data Services.\nQuery Techniques NHibernate offers a world of choice when it comes to methods for querying the model: HQL, Criteria, QueryOver, LINQ, Named Queries, etc. These each offer a plethora of possible options and tweaks including query caching, batching and futures. By comparison, Entity Framework offers a comprehensive LINQ provider (with decent extensions to specify eager-loading of child entities), or Entity SQL. And that’s your lot.\nBy the end of my fourth day, I had a working proof-of-concept using Entity Framework Code First to power my client’s application, and I had a good idea of how suitable it was to meet future requirements lurking in the product backlog.\nIn the fifth and final part of this series of posts, I’ll write some concluding thoughts on my overall experiences spending a week with Entity Framework.\n",
  "wordCount" : "708",
  "inLanguage": "en",
  "datePublished": "2011-03-10T09:03:00Z",
  "dateModified": "2025-04-21T21:56:00+01:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://bloghugo.iannelson.uk/entity-framework-week-part-4-features-and-further-investigations/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ian Nelson",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bloghugo.iannelson.uk/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://bloghugo.iannelson.uk/" accesskey="h" title="Ian Nelson (Alt + H)">Ian Nelson</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Entity Framework Week Part 4: Features and Further Investigations
    </h1>
    <div class="post-meta"><span title='2011-03-10 09:03:00 +0000 GMT'>March 10, 2011</span>

</div>
  </header> 
  <div class="post-content"><p><em>This is the fourth in a series of five posts recounting my experiences using Entity Framework Code-First to replace ADO.NET and stored procedures in a client’s existing application. <a href="https://blog.iannelson.uk/entity-framework-week-part-1-introduction-configuration-and-initialization/">The introductory post in the series is here</a>.</em></p>
<p>I didn’t want this series of posts to descend into a point-scoring <a href="http://www.nhforge.org">NHibernate</a>-versus-<a href="http://msdn.microsoft.com/en-us/library/bb399572.aspx">Entity Framework</a> comparison, but…</p>
<p>I now have a basic proof-of-concept up and running, with my client’s nascent application now being powered by Entity Framework Code-First CTP5 rather than a hand-rolled DAL. So, I had some time to consider future functional and non-functional requirements that the team would be asked to develop and support, and investigate how EF would meet the challenge.</p>
<h3 id="caching">Caching<a hidden class="anchor" aria-hidden="true" href="#caching">#</a></h3>
<p>I was genuinely surprised to learn that Entity Framework still doesn’t include any out-of-the-box support for integrating second-level caching, for example to cache reference data. It seems there is a body of opinion stating that caching should not be the responsibility of the data access layer. I disagree, and I think this is one of the major benefits NHibernate still has over Entity Framework, with its multiple flexible and configurable second-level cache providers.</p>
<h3 id="targeting-alternative-providers-sqlite-">Targeting Alternative Providers (SQLite)<a hidden class="anchor" aria-hidden="true" href="#targeting-alternative-providers-sqlite-">#</a></h3>
<p>When working with NHibernate, I often target <a href="http://www.sqlite.org">SQLite</a> for fast integration tests against an in-memory database, rather than maintaining a testing version of the MSSQL/Oracle databases that my applications usually use for their bitbucket. I was pleased to see the discussions on the System.Data.SQLite page suggesting that this approach is possible with Entity Framework too, but I didn’t spend any time attempting to get this working.</p>
<h3 id="auditing-functionality">Auditing Functionality<a hidden class="anchor" aria-hidden="true" href="#auditing-functionality">#</a></h3>
<p>Entity Framework does not appear to support the rich events and listeners model that is offered by NHibernate and frequently used to develop application auditing functionality. The recommended solution to achieve this scenario is to override the virtual SaveChanges method on DbContext and add validation and auditing logic there. For more details, see <a href="http://my.safaribooksonline.com/book/software-engineering-and-development/9780596807276/working-with-object-services/261">page 261 of Programming Entity Framework</a>.</p>
<h3 id="bulk-operations">Bulk Operations<a hidden class="anchor" aria-hidden="true" href="#bulk-operations">#</a></h3>
<p>I have not yet encountered any Entity Framework support for bulk update/delete operations akin to NHibernate’s <a href="http://ayende.com/blog/archive/2009/05/28/nhibernate-ndash-executable-dml.aspx">Executable DML</a> functionality. Such requirements are usually relatively rare, but it’s a shame to have to fall back to writing stored procedures for relatively simple operations which can be described in terms of the domain model.</p>
<h3 id="query-batching">Query Batching<a hidden class="anchor" aria-hidden="true" href="#query-batching">#</a></h3>
<p>There does not appear to be any way to do query batching in Entity Framework, as per <a href="http://ayende.com/blog/archive/2009/04/27/nhibernate-futures.aspx">NHibernate Futures</a>. Multiple queries result in multiple network trips to the database, sadly. Similarly, there’s no support for write batching and batched collection loads.</p>
<h3 id="concurrency-and-versioning">Concurrency and Versioning<a hidden class="anchor" aria-hidden="true" href="#concurrency-and-versioning">#</a></h3>
<p>Entity framework supports optimistic concurrency. <a href="http://my.safaribooksonline.com/book/software-engineering-and-development/9780596807276/planning-for-concurrency-problems/659">Chapter 23 of Programming Entity Framework</a> explains in detail how this can be configured and utilised by your application. Entity Framework also supports rowversion fields for concurrency checks.</p>
<h3 id="extra-lazy-properties">Extra-Lazy Properties<a hidden class="anchor" aria-hidden="true" href="#extra-lazy-properties">#</a></h3>
<p>Unlike NHibernate, Entity Framework currently has no notion of “extra-lazy” properties. Requesting the Count of a child collection (e.g. Order.Lines.Count) will therefore trigger the loading of all entities (Lines) in the child collection. Not nice. Yes, we can work around this by making the appropriate count query at a higher level but it’s much nicer to be able to traverse the domain model relationships and let persistence ignorance work it’s magic.</p>
<h3 id="integration-with-the-wider-net-stack">Integration with the Wider .NET Stack<a hidden class="anchor" aria-hidden="true" href="#integration-with-the-wider-net-stack">#</a></h3>
<p>To my mind, one of the key selling points of Entity Framework over NHibernate is its out-of-the-box integration with other areas of the .NET stack – notably the ability to power <a href="http://www.asp.net/dynamicdata">ASP.NET Dynamic Data</a> sites (which are great for simple pages to maintain reference data) and <a href="http://msdn.microsoft.com/en-us/data/bb931106">WCF Data Services</a>.</p>
<h3 id="query-techniques">Query Techniques<a hidden class="anchor" aria-hidden="true" href="#query-techniques">#</a></h3>
<p>NHibernate offers a world of choice when it comes to methods for querying the model: HQL, Criteria, QueryOver, LINQ, Named Queries, etc. These each offer a plethora of possible options and tweaks including query caching, batching and futures. By comparison, Entity Framework offers a comprehensive LINQ provider (with decent extensions to specify eager-loading of child entities), or Entity SQL. And that’s your lot.</p>
<p>By the end of my fourth day, I had a working proof-of-concept using Entity Framework Code First to power my client’s application, and I had a good idea of how suitable it was to meet future requirements lurking in the product backlog.</p>
<p>In the <a href="https://blog.iannelson.uk/entity-framework-week-part-5-concluding-thoughts/">fifth and final part of this series of posts</a>, I’ll write some concluding thoughts on my overall experiences spending a week with Entity Framework.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://bloghugo.iannelson.uk/tags/tidy/">Tidy</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://bloghugo.iannelson.uk/">Ian Nelson</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
